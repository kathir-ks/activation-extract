#!/bin/bash
# Configuration file for 8-host deployment
# Source this file before running: source config_8hosts.env

################################################################################
# GCP CONFIGURATION
################################################################################
export PROJECT_ID="absolute-axis-470415-g6"
export ZONE="us-central1-a"
export TPU_NAME="v5e-main-1"  # CHANGE THIS

################################################################################
# DOCKER IMAGE
################################################################################
export AR_REGION="us-central1"
export AR_REPO="arc-agi-us-central1"  # CHANGE THIS
export IMAGE_TAG="activation-extraction"

################################################################################
# DATASET CONFIGURATION
################################################################################
# Option 1: Single JSONL file
# export DATASET_PATH="gs://fineweb-data-us-central1-a/sharded_barc200k/arc_barc200k_full.jsonl"

# Option 2: Sharded dataset (for automatic shard claiming)
export USE_SHARDED_DATASET="--use_sharded_dataset"
export SHARDED_DATASET_DIR="gs://fineweb-data-us-central1-a/sharded_barc200k"

################################################################################
# GCS OUTPUT
################################################################################
export GCS_BUCKET="fineweb-data-us-central1-a"
export GCS_PREFIX="activations_barc200k_8hosts_$(date +%Y%m%d_%H%M%S)"

################################################################################
# MODEL CONFIGURATION
################################################################################
export MODEL_PATH="KathirKs/qwen-2.5-0.5b"
# For larger models:
# export MODEL_PATH="Qwen/Qwen2.5-7B"

################################################################################
# EXTRACTION PARAMETERS
################################################################################
export BATCH_SIZE=4
export MAX_SEQ_LENGTH=512
export MAX_TASKS=""  # Leave empty for unlimited, or set to number

# Layers to extract (space-separated)
export LAYERS_TO_EXTRACT="10 11 12 13 14 15 16 17 18 19 20 21 22 23"

################################################################################
# MULTI-HOST SETTINGS
################################################################################
export NUM_HOSTS=8
export MESH_TYPE="2d"  # Options: 1d, 2d, 3d
export COORDINATOR_PORT=8476

################################################################################
# OUTPUT SETTINGS
################################################################################
export SHARD_SIZE_GB=1.0
export COMPRESS_SHARDS="--compress_shards"
export DELETE_LOCAL="--delete_local_after_upload"
export VERBOSE="--verbose"