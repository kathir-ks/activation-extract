WARNING:root:libtpu.so and TPU device found. Setting PJRT_DEVICE=TPU.
======================================================================
DISTRIBUTED ARC-AGI INFERENCE WITH ACTIVATION EXTRACTION
======================================================================
{
  "output_filepath": "test_outputs/production_predictions.json",
  "activations_dir": "test_activations/production_run_20251005_170521",
  "model_path": "KathirKs/qwen-2.5-0.5b",
  "max_model_len": 10240,
  "grid_encoder": "GridShapeEncoder(RowNumberEncoder(MinimalGridEncoder()))",
  "prompt_version": "output-from-examples-v0",
  "dataset_path": "test_data_small.json",
  "n_tasks": 2,
  "max_output_tokens": 500,
  "predictions_per_task": 2,
  "temperature": 0.0,
  "batch_size": 2,
  "random_seed": null,
  "mesh_shape": [
    2,
    2
  ],
  "use_pjit": true,
  "extract_activations": true,
  "layers_to_extract": [
    10,
    11,
    12
  ],
  "save_every_n_batches": 10,
  "upload_to_cloud": false,
  "cloud_bucket": null,
  "verbose": false
}
======================================================================
Traceback (most recent call last):
  File "/home/kathirks_gc/.local/lib/python3.10/site-packages/jax/_src/xla_bridge.py", line 742, in backends
    backend = _init_backend(platform)
  File "/home/kathirks_gc/.local/lib/python3.10/site-packages/jax/_src/xla_bridge.py", line 828, in _init_backend
    backend = registration.factory()
  File "/home/kathirks_gc/.local/lib/python3.10/site-packages/jax/_src/xla_bridge.py", line 161, in tpu_client_timer_callback
    client = make_tpu_client(
  File "/home/kathirks_gc/.local/lib/python3.10/site-packages/jax/_src/xla_bridge.py", line 145, in make_tpu_client
    return _jax.get_c_api_client('tpu', options)
jaxlib._jax.XlaRuntimeError: UNKNOWN: TPU initialization failed: open(/dev/accel2): Operation not permitted: Operation not permitted; Couldn't open device: /dev/accel2; [/dev/accel2] 

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kathirks_gc/torch_xla/qwen/distributed_inference_with_activations.py", line 777, in <module>
    inference_main_distributed()
  File "/home/kathirks_gc/torch_xla/qwen/distributed_inference_with_activations.py", line 560, in inference_main_distributed
    mesh = setup_mesh(cfg.mesh_shape)
  File "/home/kathirks_gc/torch_xla/qwen/distributed_inference_with_activations.py", line 82, in setup_mesh
    devices = jax.devices()
  File "/home/kathirks_gc/.local/lib/python3.10/site-packages/jax/_src/xla_bridge.py", line 942, in devices
    return get_backend(backend).devices()
  File "/home/kathirks_gc/.local/lib/python3.10/site-packages/jax/_src/xla_bridge.py", line 876, in get_backend
    return _get_backend_uncached(platform)
  File "/home/kathirks_gc/.local/lib/python3.10/site-packages/jax/_src/xla_bridge.py", line 855, in _get_backend_uncached
    bs = backends()
  File "/home/kathirks_gc/.local/lib/python3.10/site-packages/jax/_src/xla_bridge.py", line 758, in backends
    raise RuntimeError(err_msg)
RuntimeError: Unable to initialize backend 'tpu': UNKNOWN: TPU initialization failed: open(/dev/accel2): Operation not permitted: Operation not permitted; Couldn't open device: /dev/accel2; [/dev/accel2]  (set JAX_PLATFORMS='' to automatically choose an available backend)
Command exited with non-zero status 1
	Command being timed: "python distributed_inference_with_activations.py --model_path KathirKs/qwen-2.5-0.5b --dataset_path test_data_small.json --output_filepath test_outputs/production_predictions.json --activations_dir test_activations/production_run_20251005_170521 --batch_size 2 --n_tasks 2 --max_output_tokens 500 --predictions_per_task 2 --grid_encoder GridShapeEncoder(RowNumberEncoder(MinimalGridEncoder())) --prompt_version output-from-examples-v0 --extract_activations --layers_to_extract 10 11 12 --mesh_shape 2 2"
	User time (seconds): 24.32
	System time (seconds): 2.56
	Percent of CPU this job got: 279%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 0:09.63
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1195392
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 8
	Minor (reclaiming a frame) page faults: 482879
	Voluntary context switches: 2358
	Involuntary context switches: 575
	Swaps: 0
	File system inputs: 0
	File system outputs: 104
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 1
