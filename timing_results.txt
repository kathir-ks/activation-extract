Configuration:
  Dataset: test_data_small.json
  Output: timing_test_output

=========================================
TEST 1: Small dataset (2 tasks x 5 preds)
=========================================
Start time: Sun Nov  2 16:20:23 UTC 2025
======================================================================
ARC-AGI ACTIVATION EXTRACTION (FORWARD PASS ONLY)
======================================================================
{
  "model_path": "KathirKs/qwen-2.5-0.5b",
  "dataset_path": "test_data_small.json",
  "n_tasks": 2,
  "grid_encoder": "GridShapeEncoder(RowNumberEncoder(MinimalGridEncoder()))",
  "prompt_version": "output-from-examples-v0",
  "predictions_per_task": 5,
  "layers_to_extract": [
    10,
    11,
    12,
    13,
    14,
    15,
    16,
    17,
    18,
    19,
    20,
    21,
    22,
    23
  ],
  "batch_size": 8,
  "max_seq_length": 2048,
  "output_dir": "timing_test_output_test1",
  "save_every_n_batches": 10,
  "upload_to_gcs": false,
  "gcs_bucket": null,
  "gcs_prefix": "activations",
  "shard_size_gb": 0.001,
  "compress_shards": true,
  "delete_local_after_upload": false,
  "random_seed": 42,
  "verbose": false,
  "use_data_parallel": true
}
======================================================================

Found 4 device(s): ['TPU v4', 'TPU v4', 'TPU v4', 'TPU v4']

Loading dataset from test_data_small.json...
Loaded 2 tasks
Loading tokenizer from KathirKs/qwen-2.5-0.5b...
Loading HF model for weight conversion...
Creating JAX model with activation hooks for layers [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]...
Converting HF weights to JAX...

Creating grid encoder: GridShapeEncoder(RowNumberEncoder(MinimalGridEncoder()))

Creating prompts...
Created 6 prompts

Tokenizing prompts...

Creating batches (batch_size=8)...
Created 1 batches

Extracting activations from layers [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]...
Mode: Data Parallel

======================================================================
EXTRACTION COMPLETE!
Activations saved to: timing_test_output_test1
======================================================================
	Command being timed: "python3 extract_activations_arc.py --dataset_path test_data_small.json --n_tasks 2 --predictions_per_task 5 --output_dir timing_test_output_test1 --shard_size_gb 0.001 --compress_shards"
	User time (seconds): 65.95
	System time (seconds): 15.07
	Percent of CPU this job got: 203%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 0:39.85
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 13580016
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 1
	Minor (reclaiming a frame) page faults: 2110289
	Voluntary context switches: 103585
	Involuntary context switches: 458
	Swaps: 0
	File system inputs: 0
	File system outputs: 254912
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0

End time: Sun Nov  2 16:21:03 UTC 2025
Duration: 40 seconds

Output:
  Shards: 84
  Total size: 125M

=========================================
TEST 2: Medium dataset (2 tasks x 10 preds)
=========================================
Start time: Sun Nov  2 16:21:03 UTC 2025
======================================================================
ARC-AGI ACTIVATION EXTRACTION (FORWARD PASS ONLY)
======================================================================
{
  "model_path": "KathirKs/qwen-2.5-0.5b",
  "dataset_path": "test_data_small.json",
  "n_tasks": 2,
  "grid_encoder": "GridShapeEncoder(RowNumberEncoder(MinimalGridEncoder()))",
  "prompt_version": "output-from-examples-v0",
  "predictions_per_task": 10,
  "layers_to_extract": [
    10,
    11,
    12,
    13,
    14,
    15,
    16,
    17,
    18,
    19,
    20,
    21,
    22,
    23
  ],
  "batch_size": 8,
  "max_seq_length": 2048,
  "output_dir": "timing_test_output_test2",
  "save_every_n_batches": 10,
  "upload_to_gcs": false,
  "gcs_bucket": null,
  "gcs_prefix": "activations",
  "shard_size_gb": 0.001,
  "compress_shards": true,
  "delete_local_after_upload": false,
  "random_seed": 42,
  "verbose": false,
  "use_data_parallel": true
}
======================================================================

Found 4 device(s): ['TPU v4', 'TPU v4', 'TPU v4', 'TPU v4']

Loading dataset from test_data_small.json...
Loaded 2 tasks
Loading tokenizer from KathirKs/qwen-2.5-0.5b...
Loading HF model for weight conversion...
Creating JAX model with activation hooks for layers [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]...
Converting HF weights to JAX...

Creating grid encoder: GridShapeEncoder(RowNumberEncoder(MinimalGridEncoder()))

Creating prompts...
Created 10 prompts

Tokenizing prompts...

Creating batches (batch_size=8)...
Created 2 batches

Extracting activations from layers [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23]...
Mode: Data Parallel

======================================================================
EXTRACTION COMPLETE!
Activations saved to: timing_test_output_test2
======================================================================
	Command being timed: "python3 extract_activations_arc.py --dataset_path test_data_small.json --n_tasks 2 --predictions_per_task 10 --output_dir timing_test_output_test2 --shard_size_gb 0.001 --compress_shards"
	User time (seconds): 91.39
	System time (seconds): 15.73
	Percent of CPU this job got: 195%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 0:54.74
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 13589480
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 2563600
	Voluntary context switches: 145703
	Involuntary context switches: 552
	Swaps: 0
	File system inputs: 0
	File system outputs: 411400
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0

End time: Sun Nov  2 16:21:58 UTC 2025
Duration: 55 seconds

Output:
  Shards: 140
  Total size: 201M

=========================================
SUMMARY AND PROJECTIONS
=========================================

Calculating projections...

Test 1 (2 tasks x 5 preds):
  Total samples: 84
  Total shards: 84

Test 2 (2 tasks x 10 preds):
  Total samples: 140
  Total shards: 140

==================================================
PROJECTIONS FOR LARGE-SCALE EXTRACTION
==================================================

Assuming barc200 dataset characteristics:
  Tasks: 200
  Predictions per task: 100
  Total prompts: 20,000
  Layers: 14
  Total samples: 280,000

Based on current timing (assuming linear scaling):

  Test 1: 3.50 samples/second
  Test 2: 5.09 samples/second
  Average: 4.30 samples/second

Single machine (v4 TPU):
  Total time: 65185 seconds
  Time: 18.1 hours (0.75 days)

16 machines (8 v5e + 8 v6e):
  Total time: 4074 seconds
  Time: 1.1 hours (0.05 days)

Throughput:
  Single machine: 11.0 tasks/hour
  16 machines: 176.7 tasks/hour

=========================================
=========================================
